{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport axios from 'axios';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nvar API_URL = 'http://localhost:8082/api';\nexport var loginUser = function () {\n  var _ref = _asyncToGenerator(function* (email, password) {\n    try {\n      var response = yield axios.post(`${API_URL}/auth/signin`, {\n        email: email,\n        password: password\n      });\n      console.log('Login successful:', response.data);\n      var nom = response.data.username;\n      console.log('Username:', nom);\n      var jwtToken = response.data.jwtToken;\n      console.log('JWT Token:', jwtToken);\n      axios.defaults.headers.common = {\n        'Authorization': `Bearer ${jwtToken}`\n      };\n      yield AsyncStorage.setItem('Username', nom);\n      yield AsyncStorage.setItem('jwtToken', jwtToken);\n      console.log('JWT Token saved to AsyncStorage');\n    } catch (error) {\n      console.error('Login Error:', error);\n    }\n  });\n  return function loginUser(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var registerUser = function () {\n  var _ref2 = _asyncToGenerator(function* (email, username, password) {\n    try {\n      var response = yield axios.post(`${API_URL}/auth/signup`, {\n        email: email,\n        username: username,\n        password: password\n      });\n      console.log('Registration successful:', response.data);\n    } catch (error) {\n      console.error('Registration Error:', error);\n    }\n  });\n  return function registerUser(_x3, _x4, _x5) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport var registerUserRole = function () {\n  var _ref3 = _asyncToGenerator(function* (email, username, password, role) {\n    try {\n      var response = yield axios.post(`${API_URL}/auth/signup`, {\n        email: email,\n        username: username,\n        password: password,\n        role: role\n      });\n      console.log('Registration successful:', response.data);\n    } catch (error) {\n      console.error('Registration Error:', error);\n    }\n  });\n  return function registerUserRole(_x6, _x7, _x8, _x9) {\n    return _ref3.apply(this, arguments);\n  };\n}();\nexport var fetchUserRole = function () {\n  var _ref4 = _asyncToGenerator(function* (email) {\n    try {\n      var jwtToken = yield AsyncStorage.getItem('jwtToken');\n      if (!jwtToken) {\n        throw new Error('JWT Token is not available');\n      }\n      axios.defaults.headers.common = {\n        'Authorization': `Bearer ${jwtToken}`\n      };\n      var response = yield axios.get(`${API_URL}/general/role/${email}`);\n      console.log('Role fetched:', response.data);\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching user role:', error);\n      return null;\n    }\n  });\n  return function fetchUserRole(_x10) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nexport var getJwtToken = function () {\n  var _ref5 = _asyncToGenerator(function* () {\n    try {\n      var jwtToken = yield AsyncStorage.getItem('jwtToken');\n      return jwtToken;\n    } catch (error) {\n      console.error('Error fetching JWT from AsyncStorage:', error);\n      return null;\n    }\n  });\n  return function getJwtToken() {\n    return _ref5.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["axios","AsyncStorage","API_URL","loginUser","_ref","_asyncToGenerator","email","password","response","post","console","log","data","nom","username","jwtToken","defaults","headers","common","setItem","error","_x","_x2","apply","arguments","registerUser","_ref2","_x3","_x4","_x5","registerUserRole","_ref3","role","_x6","_x7","_x8","_x9","fetchUserRole","_ref4","getItem","Error","get","_x10","getJwtToken","_ref5"],"sources":["C:/Users/Guille/Desktop/M13_PROJECTE2/APPITICBCN/src/services/authService.tsx"],"sourcesContent":["import axios from 'axios';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\n\r\nconst API_URL = 'http://localhost:8082/api';\r\n\r\nexport const loginUser = async (email: string, password: string): Promise<void> => {\r\n    try {\r\n        // Hacer el POST para iniciar sesión\r\n        const response = await axios.post(`${API_URL}/auth/signin`, {\r\n            email,\r\n            password,\r\n        });\r\n\r\n        console.log('Login successful:', response.data);\r\n        const nom = response.data.username;\r\n        console.log('Username:', nom);\r\n        // Supongamos que el servidor envía el JWT en el cuerpo de la respuesta\r\n        const jwtToken = response.data.jwtToken;\r\n        console.log('JWT Token:', jwtToken);\r\n\r\n        axios.defaults.headers.common = {'Authorization': `Bearer ${jwtToken}`}\r\n\r\n        // Guardar el JWT en AsyncStorage\r\n        await AsyncStorage.setItem('Username', nom);\r\n        await AsyncStorage.setItem('jwtToken', jwtToken);\r\n        console.log('JWT Token saved to AsyncStorage');\r\n\r\n    } catch (error) {\r\n        console.error('Login Error:', error);\r\n    }\r\n}\r\n\r\nexport const registerUser = async (email: string, username: string, password: string): Promise<void> => {\r\n    try {\r\n        // Hacer el POST para registrar\r\n        const response = await axios.post(`${API_URL}/auth/signup`, {\r\n            email,\r\n            username,\r\n            password,\r\n        });\r\n\r\n        console.log('Registration successful:', response.data);\r\n\r\n    } catch (error) {\r\n        console.error('Registration Error:', error);\r\n    }\r\n};\r\n\r\nexport const registerUserRole = async (email: string, username: string, password: string, role: string): Promise<void> => {\r\n    try {\r\n        // Hacer el POST para registrar\r\n        const response = await axios.post(`${API_URL}/auth/signup`, {\r\n            email,\r\n            username,\r\n            password,\r\n            role,\r\n        });\r\n\r\n        console.log('Registration successful:', response.data);\r\n\r\n    } catch (error) {\r\n        console.error('Registration Error:', error);\r\n    }\r\n};\r\n\r\nexport const fetchUserRole = async (email) => {\r\n    try {\r\n        const jwtToken = await AsyncStorage.getItem('jwtToken'); // Obtener el JWT almacenado\r\n\r\n        if (!jwtToken) {\r\n            throw new Error('JWT Token is not available');\r\n        }\r\n\r\n        axios.defaults.headers.common = {'Authorization': `Bearer ${jwtToken}`}\r\n        const response = await axios.get(`${API_URL}/general/role/${email}`);\r\n        console.log('Role fetched:', response.data);\r\n        return response.data; // Asumiendo que el rol viene directamente en response.data\r\n    } catch (error) {\r\n        console.error('Error fetching user role:', error);\r\n        return null; // Maneja el error como consideres necesario\r\n    }\r\n}\r\n\r\nexport const getJwtToken = async (): Promise<string | null> => {\r\n    try {\r\n        const jwtToken = await AsyncStorage.getItem('jwtToken');\r\n        return jwtToken;\r\n    } catch (error) {\r\n        console.error('Error fetching JWT from AsyncStorage:', error);\r\n        return null;\r\n    }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}